(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{522:function(t,e,n){"use strict";n.r(e);var l=n(35),r=(n(106),n(123),n(6),n(76)),o=n.n(r),c=(n(189),{name:"Listings",middleware:"auth",data:function(){return{makes:[],models:[],headers:[{text:"Make",value:"make"},{text:"Model",value:"model"},{text:"Year",value:"year"},{text:"Created at",value:"createdAt"},{text:"Created by",value:"createdBy"},{text:"Actions"}],listings:[],new_listing:{makes:[],models:[],start_year:null,end_year:null},getModelName:function(t){var e=this;return e.models.find((function(n){return n._id===e.new_listing.models[t]})).model}}},fetch:function(){var t=this;return Object(l.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.getMakesList(),t.getActiveListings();case 2:case"end":return e.stop()}}),e)})))()},methods:{resetDatasetForm:function(t){t&&(this.new_listing.makes=null),this.new_listing.models=null,this.new_listing.start_year=null,this.new_listing.end_year=null},getMakeCount:function(t){return this.makes.find((function(e){return e.make===t})).count},getMakeModels:function(){var t=this;this.resetDatasetForm(!1),o.a.post("/api/listings/models/get",{makes:this.new_listing.makes}).then((function(e){t.models=e.data.models,console.log("models",t.models)})).catch((function(t){console.log(t)}))},addNewListing:function(){for(var t=this,e=[],i=0;i<this.new_listing.models.length;i++){var n=this.models.find((function(e){return e._id===t.new_listing.models[i]})),l={dataset_id:n._id,userId:this.$store.state.user.id,model:n.model,make:n.make,start_year:this.new_listing.start_year,end_year:this.new_listing.end_year,createdAt:new Date};e.push(l)}console.log(e),o.a.post("/api/listings/active/add",{models:e}).then((function(e){t.getActiveListings(),t.resetDatasetForm(!0),t.success_snackbar=!0,t.snackbar_text="Added"})).catch((function(e){console.log(e),t.$toast.error("Something went wrong")}))},deleteListing:function(t){var e=this;o.a.post("/api/listings/active/delete",{listingId:t}).then((function(t){e.getActiveListings(),e.$toast.success("Deleted")})).catch((function(t){console.log(t),e.$toast.error("Something went wrong")}))},getActiveListings:function(){var t=this;return Object(l.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o.a.get("/api/listings/active/get").then((function(e){t.listings=e.data.listings,console.log(t.listings)})).catch((function(t){console.log(t)}));case 1:case"end":return e.stop()}}),e)})))()},getMakesList:function(){var t=this;return Object(l.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o.a.get("/api/listings/makes/get").then((function(e){t.makes=e.data.makes,console.log(t.makes)})).catch((function(t){console.log(t)}));case 1:case"end":return e.stop()}}),e)})))()}}}),d=n(75),_=n(93),m=n.n(_),v=n(190),h=n(420),f=n(419),w=n(450),k=n(463),x=n(518),y=n(188),C=n(414),M=n(456),A=n(512),component=Object(d.a)(c,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("v-row",[n("v-col",{staticClass:"col-12"},[n("v-card",{attrs:{elevation:"1"}},[n("v-card-title",[t._v("\n                Search Criteria\n              ")]),t._v(" "),n("v-card-subtitle",[t._v("\n                Search for new records in your dataset and add to active search criteria with ease\n              ")]),t._v(" "),n("v-card-text",[n("form",{on:{submit:function(e){return e.preventDefault(),t.addNewListing.apply(null,arguments)}}},[n("v-row",[n("v-col",[n("label",{staticClass:"text-subtitle-1 mb-2"},[t._v("\n              \t\t\tMake\n              \t\t")]),t._v(" "),n("v-select",{attrs:{required:"",items:t.makes.map((function(t){return t.make})),multiple:"",outlined:""},on:{change:t.getMakeModels},scopedSlots:t._u([{key:"selection",fn:function(e){var l=e.item,r=e.index;return[0===r?n("v-chip",[n("span",[t._v(t._s(l))])]):t._e(),t._v(" "),1===r?n("span",{staticClass:"grey--text text-caption"},[t._v("\n\t\t\t\t\t\t\t          (+"+t._s(t.new_listing.makes.length-1)+")\n\t\t\t\t\t\t\t        ")]):t._e()]}}]),model:{value:t.new_listing.makes,callback:function(e){t.$set(t.new_listing,"makes",e)},expression:"new_listing.makes"}})],1),t._v(" "),n("v-col",[n("label",{staticClass:"text-subtitle-1"},[t._v("\n              \t\t\tModel\n              \t\t")]),t._v(" "),n("v-select",{attrs:{required:"",items:t.models,"item-text":"text","item-value":"_id",multiple:"",outlined:""},scopedSlots:t._u([{key:"selection",fn:function(e){e.item;var l=e.index;return[0===l?n("v-chip",[n("span",[t._v(t._s(t.getModelName(l)))])]):t._e(),t._v(" "),1===l?n("span",{staticClass:"grey--text text-caption"},[t._v("\n\t\t\t\t\t\t\t          (+"+t._s(t.new_listing.models.length-1)+")\n\t\t\t\t\t\t\t        ")]):t._e()]}}]),model:{value:t.new_listing.models,callback:function(e){t.$set(t.new_listing,"models",e)},expression:"new_listing.models"}})],1),t._v(" "),n("v-col",[n("label",{staticClass:"text-subtitle-1"},[t._v("\n              \t\t\tStart Year\n              \t\t")]),t._v(" "),n("v-text-field",{attrs:{required:"",type:"tel",minlength:"4",maxlength:"4",outlined:""},model:{value:t.new_listing.start_year,callback:function(e){t.$set(t.new_listing,"start_year",e)},expression:"new_listing.start_year"}})],1),t._v(" "),n("v-col",[n("label",{staticClass:"text-subtitle-1"},[t._v("\n              \t\t\tEnd year\n              \t\t")]),t._v(" "),n("v-text-field",{attrs:{required:"",type:"tel",minlength:"4",maxlength:"4",outlined:""},model:{value:t.new_listing.end_year,callback:function(e){t.$set(t.new_listing,"end_year",e)},expression:"new_listing.end_year"}})],1),t._v(" "),n("v-col",[n("label",{staticClass:"text-subtitle-1"},[t._v("\n              \t\t\tÂ \n              \t\t")]),t._v(" "),n("v-btn",{staticStyle:{height:"55px",width:"100%"},attrs:{depressed:"",color:"primary",type:"submit"}},[t._v("\n\t\t\t\t      Add\n\t\t\t\t    ")])],1)],1)],1)])],1)],1),t._v(" "),n("v-col",{staticClass:"mb-3 col-12"},[n("v-card",{attrs:{elevation:"1"}},[n("v-card-title",[t._v("\n                Active listings \n              ")]),t._v(" "),n("v-card-subtitle",[t._v("\n                Records in this table will be used by automation scripts as a feed source\n              ")]),t._v(" "),n("v-data-table",{staticClass:"elevation-1",attrs:{headers:t.headers,items:t.listings,"items-per-page":10},scopedSlots:t._u([{key:"item",fn:function(e){return[n("tr",[n("td",[t._v(t._s(e.item.make||"---"))]),t._v(" "),n("td",[t._v(t._s(e.item.model||"---"))]),t._v(" "),n("td",[t._v(t._s(e.item.start_year+" - "+e.item.end_year||"---"))]),t._v(" "),n("td",[t._v(t._s(t.$moment(e.item.createdAt).format("YYYY-MM-DD hh:mm A")))]),t._v(" "),n("td",[t._v(t._s(e.item.createdBy))]),t._v(" "),n("td",[n("v-btn",{staticStyle:{width:"35px"},attrs:{text:"",small:"",color:"red"},on:{click:function(n){return t.deleteListing(e.item._key)}}},[n("v-icon",[t._v("mdi-delete")])],1)],1)])]}}])})],1)],1)],1)],1)}),[],!1,null,null,null);e.default=component.exports;m()(component,{VBtn:v.a,VCard:h.a,VCardSubtitle:f.b,VCardText:f.c,VCardTitle:f.d,VChip:w.a,VCol:k.a,VDataTable:x.a,VIcon:y.a,VRow:C.a,VSelect:M.a,VTextField:A.a})}}]);